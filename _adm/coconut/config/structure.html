<script type="text/template" id="tpl_config_structure">
    <table class="table">
        <%
        _.each(msg, function(list, feature){
            var list_count = (feature == 'authority') ? 0 : _.size(list);
        %>
            <tr>
                <th>
                    <span style="font-size:1.3rem;"><%-feature%></span>
                    <%
                    if(list_count>0){
                    %>
                    <span id="<%-feature%>_count" class="badge badge-secondary ml-2"><%-list_count%></span>
                    <% } %>
                </th>
                <td class="text-right">
                    <%
                    if(feature != 'authority' && feature !='alarm'){
                    %>
                    <button type="button" class="btn btn-light btn-sm btn_feature_add" data-feature="<%-feature%>"><i class="fa fa-plus"></i></button>
                    <% } %>
                </td>
            </tr>
            
            <%
            if(list_count > 0){
            %>
                <tr>
                    <td colspan="2">
                        <%
                        _.each(list, function(loop, loopk)
                        {
                            // 삭제 버튼 출력 여부 결정
                            var is_print_delbtn = true;
                            if(feature =='alarm') {
                                is_print_delbtn = false;
                            }else if(feature =='output') {
                                if(loopk == 'result' || loopk =='msg'){
                                    is_print_delbtn = false;
                                }
                            }
                        %>
                        <div class="row mb-1">
                            <div class="col-sm-10">
                                <button type="button" class="btn btn-light btn-block pl-2 text-left btn-feature-column" data-feature="<%-feature%>" data-id="<%-loopk%>"><%-loopk%></button> 
                            </div>

                            <% 
                            if(is_print_delbtn){
                            %>
                            <div class="col-sm-2 text-right">
                                <button type="button" class="btn btn-light btn-sm del-feature-column" data-feature="<%-feature%>" data-id="<%-loopk%>"><i class="fas fa-eraser"></i></button>
                            </div>
                            <% 
                            } 
                            %>
                        </div>

                            <%
                            // then
                            if( feature == 'data'){
                                var then_count = 0;
                                if(!_.isUndefined(loop.then) && _.isObject(loop.then)){
                                    then_count = _.size(loop.then);
                                }
                            %>
                            <div class="row mb-1">
                                <div class="col-sm-8 pl-4">
                                    <button type="button" class="btn btn-link btn-block pl-3 text-left" data-feature="<%-feature%>" data-id="<%-loopk%>">then (<%-then_count%>)</button> 
                                </div>
    
                                <div class="col-sm-4 text-right">
                                    <button type="button" class="btn btn-light btn-sm btn_feature_then_add" data-feature="<%-feature%>"><i class="fa fa-plus"></i></button>
                                </div>
                            </div>
                            <%
                                if(!_.isUndefined(loop.then)){
                                    if(_.isObject(loop.then)){
                                        _.each(loop.then, function(thenloop,thenloopid){
                                        %>
                                        <div class="row mb-1">
                                            <div class="col-sm-10">
                                                <button type="button" class="btn btn-light btn-block pl-5 text-left btn-feature-then-column" data-feature="<%-feature%>" data-id="<%-loopk%>" data-thenid="<%-thenloopid%>" ><%-thenloopid%></button> 
                                            </div>
                
                                            <% 
                                            if(is_print_delbtn){
                                            %>
                                            <div class="col-sm-2 text-right">
                                                <button type="button" class="btn btn-link btn-sm del-feature-then-column" data-feature="<%-feature%>" data-id="<%-loopk%>" data-thenid="<%-thenloopid%>"><i class="fas fa-eraser"></i></button>
                                            </div>
                                            <% 
                                            } 
                                            %>
                                        </div>
                                        <%
                                        });
                                    }
                                }
                            }
                            %>

                        <% }); %>
                    </td>
                </tr>
            <% } else {%>
                <tr>
                    <td colspan="2">

                        <div class="row mb-1">
                            <div class="col-sm-12">
                                <button type="button" class="btn btn-light btn-block pl-5 text-left btn-feature-column" data-feature="<%-feature%>"> <%-list%></button> 
                            </div>
                        </div>
                    </td>
                </tr>
            <% } %>        
        <% }); %>
    </table>
</script>